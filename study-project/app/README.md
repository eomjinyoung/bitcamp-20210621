# 16-a. 파일 입출력 다루기 : 바이너리 형식으로 데이터 입출력

지금까지,
- 사용자가 입력한 데이터를 컬렉션 객체에 저장했다.
- 즉 RAM에 데이터가 저장되어 있어서 프로그램을 종료하거나 컴퓨터를 끄면 데이터가 지워지는 문제가 있었다.

프로그램을 종료하더라도 데이터가 지워지지 않게 하려면,
- 외부 저장장치(예: 하드 디스크, SSD 등)에 저장해야 한다.
- 즉 데이터를 파일로 출력해야 한다.

이번 훈련에서는,
- **파일 입출력 API** 를 활용하여 데이터를 파일로 저장하고
파일에서 데이터를 읽는 것을 연습할 것이다.
- **바이너리(binary)** 형식으로 입출력하는 것을 연습할 것이다.

**파일 입출력 API** 는,
- 데이터를 파일로 입출력하는 다양한 도구(*클래스*, *인터페이스*)를 제공한다.

**바이너리** 파일 포맷,
- 해당 파일 포맷을 다루는 전용 프로그램을 사용해야만 편집할 수 있다.
  - 예) 포토샵, 파워포인트, 워드, 엑셀, 동영상 편집기 등
  - 예) .class, .hwp, .doc, .xls, .ppt, .pdf, .gif, .jpg, .avi, .wav, .mp3 등
- 메모장 등 텍스트 편집기에서 직접 파일을 편집하지 못한다.
- 만약 텍스트 편집기로 편집한 후에 저장하면 파일 형식이 깨져서 무효한 파일이 된다.
- 같은 데이터를 저장하더라도 텍스트 포맷 보다는 파일의 크기가 작다.

**텍스트** 파일 포맷,
- 전용 프로그램의 도움 없이 텍스트 편집기로 직접 편집할 수 있다.
  - 예) .txt, .csv, .html, .css, .js, .java, .xml, .rtf 등

**FileInputStream** / **FileOutputStream** 은,

- 바이너리 형식으로 데이터를 읽고 쓸 때 사용하는 도구다.
- *byte stream class* 이다.

## 훈련 목표

- 바이너리 입출력 스트림 클래스를 사용하여 객체의 필드 값을 바이너리 형식으로 읽고 쓰는 방법을 배운다.


## 훈련 내용

- 사용자가 입력한 게시글, 회원, 프로젝트, 작업 데이터를 파일로 저장하고 파일에서 읽는다.


## 실습


### 1단계 - 게시글 데이터를 파일로 저장하고 파일에서 읽는다.

- com.eomcs.pms.App 클래스 변경
  - 1) 애플리케이션을 종료하기 직전 List 객체에 있는 게시글 데이터를 파일에 저장한다.
  - 2) 애플리케이션을 실행하는 즉시 파일에서 게시글 데이터를 읽어서 List 객체에 담는다.
  - 백업: App.java.01

### 2단계 - 리팩토링 : 게시글 데이터의 로딩과 저장을 수행하는 코드를 별도의 메서드로 추출한다.

- com.eomcs.pms.App 클래스 변경
  - 게시글 데이터를 파일에 저장하는 코드를 `saveBoards()` 메서드로 추출한다.
  - 게시글 데이터를 읽어오는 코드를 `loadBoards()` 메서드로 추출한다.
  - 백업: App.java.02

### 3단계 - 출력 데이터 또는 입력 데이터를 직접 가공하지 않고 데코레이터의 도움을 받아 처리한다.

이번 단계에서는,
- **파일 입출력 API** 에 적용되어 있는 **데코레이터(decorator) 패턴** 을 활용하여
  객체에 기능을 덧붙여 사용하는 방법을 연습할 것이다.

**데코레이터 패턴** 은,
- 객체에 동적으로 새로운 서비스를 추가할 수 있게 해주는 설계 기법이다.
- 상속은 정적으로 기능을 확장하는 방식으로 서브 클래스에서 기능을 한 번 추가하면,
  그 자손 클래스들은 임의로 그 기능을 뺄 수 없다.
- 그에 반해 데코레이터 패턴으로 클래스를 설계하면, 플러그인 처럼 필요한 시점에 임의로 기능을 추가하고
  뺄 수 있어 프로그래밍이 편하다.
- *데코레이터 패턴* 이 적용된 대표적인 예가 **파일 입출력 API** 이다.   

**Data Processing Stream Class** 는,
- **Decorator 패턴** 에서 데코레이터 역할을 수행하는 클래스다.
- **Data Sink Stream Class**에 연결하거나 다른 데코레이터에 연결하여 중간에서 데이터를 가공하는 일을 한다.

**DataInputStream** / **DataOutputStream** 은,

- **Decorator** 역할을 하는 **Data Processing Stream Class** 이다.
- 문자열이나 자바 원시 타입의 값들 입출력하는 메서드를 구비하고 있다.
- 이 클래스를 입출력 스트림에 연결하면, 데이터를 읽고 쓰기 편하다.

- com.eomcs.pms.App 클래스 변경
  - saveBoards() 변경 : DataOutputStream 클래스를 사용하여 출력 데이터를 가공한다.
  - loadBoards() 변경 : DataInputStream 클래스를 사용하여 입력 데이터를 가공한다.
  - 백업: App.java.03

### 4단계 - 객체를 통째로 읽고 쓰는 데코레이터를 사용하여 입출력을 수행한다.

이번 단계에서는 **ObjectInputStream/ObjectOutputStream** 데코레이터를 활용하여 객체를 출력(직렬화)하고 로딩(복원)하는 것을 연습해 볼 것이다.

**직렬화(serialize; marshalling)** 은,

- 인스턴스의 필드 값을 바이트 배열로 변환하여 출력하는 것이다.
- 클래스 정보 및 필드의 타입 정보, 클래스 버전도 포함한다.

**복원(deserialize; unmarshalling)** 은,

- 직렬화를 통해 저장된 바이트 배열을 읽어서 자바 객체로 변환하는 것이다.
- 클래스 정보와 필드 정보를 바탕으로 인스턴스를 자동 생성한다.
- 생성자나 셋터 호출 없이 인스턴스의 필드 값을 설정한다.

- com.eomcs.pms.domain.Board 클래스 변경
  - java.io.Serializable 인터페이스 구현 : 직렬화를 허락한다는 표시
- com.eomcs.pms.domain.Member 클래스 변경
  - java.io.Serializable 인터페이스 구현 : 직렬화를 허락한다는 표시
- com.eomcs.pms.App 클래스 변경
  - saveBoards() 변경 : ObjectOutputStream 클래스를 사용하여 출력 데이터를 가공한다.
  - loadBoards() 변경 : ObjectInputStream 클래스를 사용하여 입력 데이터를 가공한다.
  - 백업: App.java.04
- com.eomcs.pms.App 클래스 변경
  - List 객체를 통째로 직렬화/복원 한다.
  - 백업: App.java.05
  
### 5단계 - 버퍼를 사용하여 입출력 속도를 높힌다.

- com.eomcs.pms.App 클래스 변경
  - saveXxx() 변경 : BufferedOutputStream 데코레이터를 출력 스트림에 덧붙인다.
  - loadXxx() 변경 : BufferedInputStream 데코레이터를 입력 스트림에 덧붙인다.
  - 백업: App.java.06


### 6단계 - 제네릭을 사용하여 여러 타입의 객체 입출력을 한 개의 메서드로 다룬다.

- com.eomcs.pms.App 클래스 변경
  - saveBoards() 변경 : 제네릭을 사용하여 출력 데이터를 가공한다.
  - loadBoards() 변경 : 제네릭을 사용하여 입력 데이터를 가공한다.
  - 백업: App.java.07



## 실습 결과

- src/main/java/com/eomcs/pms/App.java 변경
